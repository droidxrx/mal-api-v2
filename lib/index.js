"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("axios"),t=require("crypto");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=a(e);function s(e,t,a){if(!t.has(e))throw new TypeError("attempted to "+a+" private field on non-instance");return t.get(e)}function n(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,s(e,t,"get"))}function r(e,t,a){return function(e,t,a){if(t.set)t.set.call(e,a);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=a}}(e,s(e,t,"set"),a),a}function o(e,t){u(e,t),t.add(e)}function l(e,t,a){u(e,t),t.set(e,a)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}var h=new WeakMap,d=new WeakMap,m=new WeakMap,_=new WeakMap,p=new WeakSet,f=new WeakSet,w=new WeakSet,v=new WeakSet,g=new WeakSet;class y{constructor(){o(this,g),o(this,v),o(this,w),o(this,f),o(this,p),l(this,h,{writable:!0,value:"https://api.myanimelist.net/v2"}),l(this,d,{writable:!0,value:"https://myanimelist.net/v1/oauth2"}),l(this,m,{writable:!0,value:`${n(this,d)}/authorize`}),l(this,_,{writable:!0,value:`${n(this,d)}/token`})}authorizeUrl(e){return`${n(this,m)}${c(this,w,b).call(this,e,"?")}`}async token(e){return new Promise(((t,a)=>{i.default.post(n(this,_),c(this,w,b).call(this,e),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>t(c(this,v,W).call(this,e)))).catch((e=>a(c(this,g,L).call(this,e))))}))}async animeMangaById(e,t,a,i){const s=`/${t}/${a}`,n={params:c(this,w,b).call(this,{fields:i})};return new Promise(((t,a)=>{c(this,p,k).call(this,e).get(s,n).then((e=>t(c(this,v,W).call(this,e)))).catch((e=>a(c(this,g,L).call(this,e))))}))}async searchAnimeManga(e,t,a){const i=`/${t}`,s={params:c(this,w,b).call(this,a)};return new Promise(((t,a)=>{c(this,p,k).call(this,e).get(i,s).then((e=>t(c(this,v,W).call(this,e)))).catch((e=>a(c(this,g,L).call(this,e))))}))}async animeMangaDeleteList(e,t,a){const i=`/${t}/${a}/my_list_status`;return new Promise(((t,a)=>{c(this,p,k).call(this,e).delete(i).then((e=>t(c(this,v,W).call(this,e)))).catch((e=>a(c(this,g,L).call(this,e))))}))}async animeMangaUpdateList(e,t,a){const i=`/${t}/my_list_status`;return new Promise(((t,s)=>{c(this,p,k).call(this,e,!0).put(i,c(this,w,b).call(this,a)).then((e=>t(c(this,v,W).call(this,e)))).catch((e=>s(c(this,g,L).call(this,e))))}))}}function k(e,t=!1){const a={baseURL:n(this,h),headers:{Authorization:`Bearer ${e}`}};return t&&(a.headers["Content-Type"]="application/x-www-form-urlencoded"),i.default.create(a)}function M(e){const t={};return Object.keys(e).forEach((a=>{Array.isArray(e[a])?t[a]=e[a].join():[null,void 0,""].includes(e[a])||(t[a]=e[a])})),t}function b(e,t){return`${null!=t?t:""}${decodeURIComponent(new URLSearchParams(c(this,f,M).call(this,e)).toString())}`}function W(e){return{status:!0,return:e.data}}function L(e){return{status:!1,return:e.response.data}}const $=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios","pictures","background","related_anime","related_manga","recommendations","statistics"],A=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios"],z=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_volumes","num_chapters","authors","pictures","background","related_anime","related_manga","recommendations","serialization"],T=["id","title","main_picture","alternative_titles","start_date","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","updated_at","media_type","status","my_list_status","num_volumes","num_chapters","authors"],C=["status","score","num_watched_episodes","is_rewatching","start_date","finish_date","priority","num_times_rewatched","rewatch_value","tags","updated_at","id","title","main_picture","alternative_titles","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","media_type","my_list_status","num_episodes","start_season","broadcast","source","average_episode_duration","rating","studios"],E=["status","score","num_volumes_read","num_chapters_read","is_rereading","start_date","finish_date","priority","num_times_reread","reread_value","tags","updated_at","id","title","main_picture","alternative_titles","end_date","synopsis","mean","rank","popularity","num_list_users","num_scoring_users","nsfw","genres","created_at","media_type","my_list_status","num_volumes","num_chapters","authors"],j=["id","name","picture","gender","birthday","location","joined_at","anime_statistics","time_zone","is_supporter"];function x(e,t){if(void 0===t)return e;{const a=[...new Set(t.filter((t=>e.includes(t))))];return 0===a.length?e:a}}function U(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var S=new WeakMap,P=new WeakMap;function q(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var B=new WeakMap,D=new WeakMap;function I(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var R=new WeakMap,O=new WeakMap;function F(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var G=new WeakMap,H=new WeakMap;function V(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var Y=new WeakMap,J=new WeakMap;function K(e){return function(e,a){const i=Math.pow(2,8),s=i/Math.min(a.length,i);let n="";for(let i=0;i<e;i++)n+=a[Math.floor(t.randomBytes(e)[i]/s)];return n}(e,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~")}function N(e){return t.createHash("sha256").update(e).digest("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Q(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var X=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap;exports.Anime=class{constructor(e){U(this,S,{writable:!0,value:void 0}),U(this,P,{writable:!0,value:new y}),r(this,S,e)}async id(e,t=$){return n(this,P).animeMangaById(n(this,S),"anime",e,x($,t))}async search(e){var t,a;const i={q:e.q,limit:null!==(t=e.limit)&&void 0!==t?t:100,offset:null!==(a=e.offset)&&void 0!==a?a:0,fields:x(A,e.fields)};return n(this,P).searchAnimeManga(n(this,S),"anime",i)}async ranking(e){var t,a,i;const s={ranking_type:null!==(t=e.ranking_type)&&void 0!==t?t:"all",limit:null!==(a=e.limit)&&void 0!==a?a:100,offset:null!==(i=e.offset)&&void 0!==i?i:0,fields:x(A,e.fields)};return n(this,P).searchAnimeManga(n(this,S),"anime/ranking",s)}async seasonal(e){var t,a,i,s;const r={sort:null!==(t=e.sort)&&void 0!==t?t:"anime_score",limit:null!==(a=e.limit)&&void 0!==a?a:100,offset:null!==(i=e.offset)&&void 0!==i?i:0,fields:x(A,e.fields)},o=null!==(s=e.year)&&void 0!==s?s:(new Date).getFullYear(),l=void 0!==e.season&&(c=e.season,["spring","summer","fall","winter"].includes(c.toLowerCase()))?e.season.toLowerCase():(u=+(new Date).toLocaleString("default",{month:"numeric"}))>2&&u<6?"spring":u>5&&u<9?"summer":u>8&&u<12?"fall":"winter";var u,c;return n(this,P).searchAnimeManga(n(this,S),`anime/season/${o}/${l}`,r)}async suggested(e){var t,a;const i={limit:null!==(t=e.limit)&&void 0!==t?t:100,offset:null!==(a=e.offset)&&void 0!==a?a:0,fields:x(A,e.fields)};return n(this,P).searchAnimeManga(n(this,S),"anime/suggestions",i)}},exports.Manga=class{constructor(e){q(this,B,{writable:!0,value:void 0}),q(this,D,{writable:!0,value:new y}),r(this,B,e)}async id(e,t=z){return n(this,D).animeMangaById(n(this,B),"manga",e,x(z,t))}async search(e){var t,a;const i={q:e.q,limit:null!==(t=e.limit)&&void 0!==t?t:100,offset:null!==(a=e.offset)&&void 0!==a?a:0,fields:x(T,e.fields)};return n(this,D).searchAnimeManga(n(this,B),"manga",i)}async ranking(e){var t,a,i;const s={ranking_type:null!==(t=e.ranking_type)&&void 0!==t?t:"all",limit:null!==(a=e.limit)&&void 0!==a?a:100,offset:null!==(i=e.offset)&&void 0!==i?i:0,fields:x(T,e.fields)};return n(this,D).searchAnimeManga(n(this,B),"manga/ranking",s)}},exports.Oauth2=class{constructor(e,t=""){Q(this,X,{writable:!0,value:void 0}),Q(this,Z,{writable:!0,value:void 0}),Q(this,ee,{writable:!0,value:""}),Q(this,te,{writable:!0,value:new y}),r(this,X,e),r(this,Z,t)}pkceGenerate(e=43){return function(e){if(e<43||e>128)throw new Error(`Expected a length between 43 and 128. Received ${e}.`);const t=K(e);return{code_challenge:N(t),code_verifier:t}}(e)}pkceVerifyChallenge(e,t){return function(e,t){return N(e)===t}(e,t)}urlAuthorize(e,t=""){return r(this,ee,t),n(this,te).authorizeUrl({client_id:n(this,X),code_challenge:e,code_challenge_method:"plain",redirect_uri:t,response_type:"code"})}async getToken(e,t){return n(this,te).token({client_id:n(this,X),client_secret:n(this,Z),code:e,code_verifier:t,grant_type:"authorization_code",redirect_uri:n(this,ee)})}async refreshToken(e){return n(this,te).token({client_id:n(this,X),client_secret:n(this,Z),refresh_token:e,grant_type:"refresh_token"})}},exports.User=class{constructor(e){V(this,Y,{writable:!0,value:void 0}),V(this,J,{writable:!0,value:new y}),r(this,Y,e)}async get(e="@me",t=j){return n(this,J).searchAnimeManga(n(this,Y),`users/${e}`,{fields:x(j,t)})}},exports.UserAnimeList=class{constructor(e){I(this,R,{writable:!0,value:void 0}),I(this,O,{writable:!0,value:new y}),r(this,R,e)}async getList(e){var t,a,i,s;const r={status:e.status,sort:null!==(t=e.sort)&&void 0!==t?t:"anime_title",limit:null!==(a=e.limit)&&void 0!==a?a:100,offset:null!==(i=e.offset)&&void 0!==i?i:0,fields:x(C,e.fields)};return n(this,O).searchAnimeManga(n(this,R),`users/${null!==(s=e.user_name)&&void 0!==s?s:"@me"}/animelist`,r)}async deleteList(e){return n(this,O).animeMangaDeleteList(n(this,R),"anime",e)}async updateList(e){return n(this,O).animeMangaUpdateList(n(this,R),"anime",e)}},exports.UserMangaList=class{constructor(e){F(this,G,{writable:!0,value:void 0}),F(this,H,{writable:!0,value:new y}),r(this,G,e)}async getList(e){var t,a,i,s;const r={status:e.status,sort:null!==(t=e.sort)&&void 0!==t?t:"manga_title",limit:null!==(a=e.limit)&&void 0!==a?a:100,offset:null!==(i=e.offset)&&void 0!==i?i:0,fields:x(E,e.fields)};return n(this,H).searchAnimeManga(n(this,G),`users/${null!==(s=e.user_name)&&void 0!==s?s:"@me"}/mangalist`,r)}async deleteList(e){return n(this,H).animeMangaDeleteList(n(this,G),"manga",e)}async updateList(e){return n(this,H).animeMangaUpdateList(n(this,G),"manga",e)}};
